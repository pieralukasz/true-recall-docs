---
// Client-side only - no server logic needed
---

<user-auth-icon>
  <a href="/login" class="user-auth-link" data-auth-link>
    <svg class="icon-outline" width="20" height="20" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="8" r="4"/>
      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
    </svg>
    <svg class="icon-filled" width="20" height="20" viewBox="0 0 24 24"
         fill="currentColor" style="display:none">
      <circle cx="12" cy="8" r="4"/>
      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
    </svg>
    <span class="sr-only">User account</span>
  </a>
</user-auth-icon>

<script>
  import { supabase } from '../lib/supabase';

  class UserAuthIconElement extends HTMLElement {
    async connectedCallback() {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        const link = this.querySelector('[data-auth-link]') as HTMLAnchorElement;
        const outline = this.querySelector('.icon-outline') as SVGElement;
        const filled = this.querySelector('.icon-filled') as SVGElement;

        if (session) {
          link.href = '/dashboard';
          outline.style.display = 'none';
          filled.style.display = 'block';
        }
      } catch (error) {
        console.error('Error checking auth state:', error);
      }
    }
  }

  customElements.define('user-auth-icon', UserAuthIconElement);
</script>

<style>
  user-auth-icon {
    display: flex;
    align-items: center;
  }

  .user-auth-link {
    display: flex;
    align-items: center;
    padding: 0.5em;
    margin: -0.5em;
    color: var(--sl-color-text-accent, var(--color-text-muted, #a0a0a0));
    transition: opacity 0.2s;
  }

  .user-auth-link:hover {
    opacity: 0.66;
    text-decoration: none;
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
</style>
